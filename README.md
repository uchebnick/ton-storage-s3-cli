# TON Storage S3 Gateway

–≠—Ç–æ **S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —à–ª—é–∑** –¥–ª—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ TON Storage. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –±–ª–æ–∫—á–µ–π–Ω TON, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–≤—ã—á–Ω—ã–µ s3 –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **S3 API**: –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å Amazon S3 (Put, Get, Head, Delete).
*   **–ê–≤—Ç–æ-—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è**: –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ TON Storage, —á—Ç–æ–±—ã –¥–æ—Å—Ç–∏—á—å –∑–∞–¥–∞–Ω–Ω–æ–≥–æ —á–∏—Å–ª–∞ –∫–æ–ø–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 —Ä–µ–ø–ª–∏–∫).
*   **–ê—É–¥–∏—Ç –∏ –∑–∞—â–∏—Ç–∞**: –î–µ–º–æ–Ω-–∞—É–¥–∏—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —á–µ—Å—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤. –ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä —É–¥–∞–ª–∏–ª —Ñ–∞–π–ª, —Å–∏—Å—Ç–µ–º–∞ –∑–∞–±–µ—Ä–µ—Ç —É –Ω–µ–≥–æ –¥–µ–Ω—å–≥–∏ (Withdraw) –∏ –Ω–∞–π–¥–µ—Ç –Ω–æ–≤–æ–≥–æ.
*   **–ò–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å**: –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1.  **S3 Gateway (API)** ‚Äî –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–∞–π–ª—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL.
2.  **Replicator Daemon (–¶–µ–ª–∏—Ç–µ–ª—å)** ‚Äî –°–ª–µ–¥–∏—Ç, —á—Ç–æ–±—ã —É –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –±—ã–ª–æ –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–ø–∏–π.
3.  **Auditor Daemon (–ü–æ–ª–∏—Ü–µ–π—Å–∫–∏–π)** ‚Äî –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã —Ö—Ä–∞–Ω–µ–Ω–∏—è. –ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∂—É–ª—å–Ω–∏—á–∞–µ—Ç, —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ä–µ–¥—Å—Ç–≤–∞.


---

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (—á–µ—Ä–µ–∑ AWS CLI)

–ü–æ—Å–∫–æ–ª—å–∫—É —à–ª—é–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å S3, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é —É—Ç–∏–ª–∏—Ç—É `aws`.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
```bash
aws configure set aws_access_key_id "MY_KEY"
aws configure set aws_secret_access_key "MY_SECRET"
aws configure set region "us-east-1"
```

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ (Upload)
–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª `image.jpg` –≤ –±–∞–∫–µ—Ç `my-files`.
```bash
aws s3api put-object \
    --bucket my-files \
    --key image.jpg \
    --body ./image.jpg \
    --endpoint-url http://localhost:8080
```
*–°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–Ω–µ—Ç –∏—Å–∫–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ TON –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.*

### 2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ (Download)
```bash
aws s3api get-object \
    --bucket my-files \
    --key image.jpg \
    output_image.jpg \
    --endpoint-url http://localhost:8080
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ (Head)
–£–∑–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.
```bash
aws s3api head-object \
    --bucket my-files \
    --key image.jpg \
    --endpoint-url http://localhost:8080
```

---

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞ (Daemon Logic)

### Replicator (–†–µ–ø–ª–∏–∫–∞—Ç–æ—Ä)
1.  –°–º–æ—Ç—Ä–∏—Ç –≤ –ë–î: ¬´–§–∞–π–ª—É `image.jpg` –Ω—É–∂–Ω–æ 5 –∫–æ–ø–∏–π¬ª.
2.  –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: ¬´–°–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤ - 3¬ª.
3.  –î–µ–π—Å—Ç–≤–∏–µ: –ù–∞—Ö–æ–¥–∏—Ç –µ—â–µ 2 –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –≤ —Å–µ—Ç–∏ TON –∏ –∑–∞–∫–ª—é—á–∞–µ—Ç —Å –Ω–∏–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã.

### Auditor (–ê—É–¥–∏—Ç–æ—Ä)
1.  –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –≤—Å–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º.
2.  –°–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è (Proof).
3.  **–ï—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –º–æ–ª—á–∏—Ç**:
    *   –ü–æ–º–µ—á–∞–µ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∫–∞–∫ `failed`.
    *   **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–≤–æ–¥–∏—Ç –¥–µ–Ω—å–≥–∏** (Withdraw) —Å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –≤–∞—à –∫–æ—à–µ–ª–µ–∫.
    *   –°–æ–æ–±—â–∞–µ—Ç –†–µ–ø–ª–∏–∫–∞—Ç–æ—Ä—É, —á—Ç–æ –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–ø–∏—è.